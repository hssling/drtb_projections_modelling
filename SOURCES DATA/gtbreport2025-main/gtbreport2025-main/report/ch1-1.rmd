--- 
title: "Section 1.1 TB incidence" 
author: "Mathieu Bastard, reformatted/refactored by Hazim Timimi" 
date: "`r Sys.Date()`" 
knit: (function(inputFile, encoding) {
      out_dir <- "./local";
      rmarkdown::render(inputFile,
                        encoding=encoding,
                        output_dir=file.path(dirname(inputFile), out_dir))})
output:
  html_fragment:
    # Don’t include a table of contents
    toc: no
    # Set standard figure width to 12 inches
    fig_width: 12
    # Don’t write figure captions
    fig_caption: FALSE
    # Don't embed external resources (stylesheets, JS libraries) in the output
    self_contained: FALSE
    # Don't include <div> tags around a header and the content found until the next header
    section_divs: FALSE  

# To run this file and store output as html:
# rmarkdown::render(here::here("report/ch1-1.rmd"), output_file = "ch1-1.html", output_dir = here::here("report/local/"))
--- 


```{r setup, include=FALSE} 
# Chapter 1
# Set options, load data, utility functions 

knitr::opts_chunk$set(echo = FALSE, 
                      results = "asis",
                      message = FALSE,
                      warning = FALSE,
                      error = TRUE, # for debugging!
                      
                      # Settings for better output of whomapper .png maps
                      fig.width = 10,
                      fig.height = 5,
                      dpi = 350
                      )

# Kill any attempt at using factors, unless we explicitly want them!
options(stringsAsFactors=FALSE)
options(scipen=999)


# Load output packages ----
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
library(data.table)
library(gtbreport)
library(here)
library(kableExtra)
library(gridExtra)
# library(whomap)
# devtools::install_github("yamanakatakuya/whomapR")
# from https://github.com/yamanakatakuya/whomapR
library(whomapR)
library(ggrepel)
library(ggpubr)
library(RColorBrewer)
library(tidyverse)
library(stringr)
library(jsonlite)
library(dplyr)

# Prepare data for the chapter
source(here('report/ch1_prepare_data.R'))

# Load R functions ----
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

source(here("report/functions/html_links.R"))

# Load standard note about Indonesia moving to WPR ----
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
source(here("report/resources/IDN_2_WPR_note.R"))


# Set output options ----
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 


# Show static chart in addition to Kendo chart?
show_static = FALSE

# Save underlying data files as CSV and charts as PDF files?
pdf_csv_folder = here::here("report/local/figures/ch1-1")
save_csv = TRUE
save_pdf = TRUE
save_hidef = FALSE # TRUE only for producing a high definition map for the PDF!

# Create the output folder (only if it doesn't yet exist)
dir.create(pdf_csv_folder, showWarnings = FALSE, recursive = TRUE)


``` 

```{r css_js}
# Add standard stylesheets and javascript to support kendo
cat(writeLines(readLines(here("report/resources/headers.htm"))))
```

```{css, echo=FALSE}

/* Table 1.1.1 */
/* Recreating simple striped bootstrap table */
#burden_num_table {
  border-spacing: 0;
  border-collapse: collapse;
  margin-top: 1em;
  margin-bottom: 1em;
  /* Next two lines to allow horizontal scrolling on narrow screens */
  display: block;
  overflow-x: auto;
}

#burden_num_table th {
  border-bottom: 2px solid #DDDDDD;
  padding: 8px;
}

#burden_num_table td {
  border-top: 1px solid #DDDDDD;
  padding: 8px;
}

/* light gray for odd rows */
#burden_num_table tr:nth-child(odd) td {
  background-color: #F5F5F5;	
}

/* Bold for the final row with thick line above */
#burden_num_table tr:last-child td {
  border-top: 2px solid #DDDDDD;
  font-weight:bold;	
}

/* light gray when hovering over a row */
#burden_num_table tr:hover td {
  background-color: #DDDDDD;
}

/* Centre-align all column headings except for the first */
#burden_num_table th:not(:first-child) {
  text-align: center !important;
}

/* prevent numbers from wrapping in any of the columns */
#burden_num_table td {
  white-space: nowrap;
}


body {
    margin: 0;
}

```

```{r}
# to format 100 000 as a R object, avoid breaking lines
cm=formatC(1e5, format="f", big.mark=" ", digits=0)

# Estimates year
yr=2024
```



# 1.1 TB incidence

_Draft! Prepared `r Sys.Date()` using country-reported data snapshot files from `r snapshot_date` and incidence estimates from `r est_date`_

An estimated global total of `r round(global$inc.num[global$year==yr]/1e6,1)` million people (95% uncertainty interval [UI]: `r round(global$inc.lo.num[global$year==yr]/1e6,1)`–`r round(global$inc.hi.num[global$year==yr]/1e6,1)` million) fell ill with TB in `r yr`, equivalent to `r round(global$inc[global$year==yr],0)` incident cases (95% UI: `r round(global$inc.lo[global$year==yr],0)`–`r round(global$inc.hi[global$year==yr],0)`) per `r cm` population (`r lnk("Table 1.1.1")`). Among all incident TB cases, `r round(100*global$inc.h.num[global$year==yr]/global$inc.num[global$year==yr],1)`% were among people living with HIV. Most TB cases in `r yr` were in the WHO regions of South-East Asia (`r round(100*regional$inc.num[regional$year==yr & regional$g.whoregion=="SEA"]/global$inc.num[global$year==yr],0)`%), the Western Pacific (`r round(100*regional$inc.num[regional$year==yr & regional$g.whoregion=="WPR"]/global$inc.num[global$year==yr],0)`%) and Africa (`r round(100*regional$inc.num[regional$year==yr & regional$g.whoregion=="AFR"]/global$inc.num[global$year==yr],0)`%), with smaller shares in the Eastern Mediterranean (`r round(100*regional$inc.num[regional$year==yr & regional$g.whoregion=="EMR"]/global$inc.num[global$year==yr],1)`%), the Americas (`r round(100*regional$inc.num[regional$year==yr & regional$g.whoregion=="AMR"]/global$inc.num[global$year==yr],1)`%) and Europe (`r round(100*regional$inc.num[regional$year==yr & regional$g.whoregion=="EUR"]/global$inc.num[global$year==yr],1)`%). 


### `r anch("Table 1.1.1")`<span class="red">Table 1.1.1</span> Global and regional estimates of TB incidence, numbers (in thousands) and rates (per `r cm` population) in `r yr`
<div class="subhead">Low and high are the 5th and 95th percentiles of the uncertainty interval (UI). `r IDN_2_WPR_note2`</div>


```{r tab_1.1.1}

tab.header <- c('Region or country group','Population','Best estimate','Low', 'High',
                  'Best estimate', 'Low', 'High',
                  'Best estimate', 'Low', 'High',
                  'Best estimate', 'Low', 'High'
                  )

knitr::kable(cbind(tabinc[c(32:37, 31, 38), 1:8], tabmort[c(32:37, 31, 38), 2:7]),
             format = "html",
             align = 'rccccccccccccc',
             col.names = tab.header,
             # Add a table ID so that it can be styled using extra CSS in Sitefinity
             table.attr = "id='burden_num_table'") |>
add_header_above(header = c(" " = 2, "Total" = 3, "People living with HIV" = 3, "Total" = 3, "People living with HIV" = 3)) |>
add_header_above(header = c(" " = 2, "Number of cases (in thousands)" = 6, "Rate per 100 000 population" = 6)) 
  # pack_rows("High burden countries", 1, 30) |>
  # pack_rows('Groupings', 31, 38) 


```

<hr />
<br />

```{r}

inc.cases.24=round(global$inc.num[global$year==2024]/1e6,1)
inc.cases.24.lo=round(global$inc.lo.num[global$year==2024]/1e6,1)
inc.cases.24.hi=round(global$inc.hi.num[global$year==2024]/1e6,1)

inc.cases.23=round(global$inc.num[global$year==2023]/1e6,1)
inc.cases.23.lo=round(global$inc.lo.num[global$year==2023]/1e6,1)
inc.cases.23.hi=round(global$inc.hi.num[global$year==2023]/1e6,1)

inc.cases.22=round(global$inc.num[global$year==2022]/1e6,1)
inc.cases.22.lo=round(global$inc.lo.num[global$year==2022]/1e6,1)
inc.cases.22.hi=round(global$inc.hi.num[global$year==2022]/1e6,1)

inc.cases.21=round(global$inc.num[global$year==2021]/1e6,1)
inc.cases.21.lo=round(global$inc.lo.num[global$year==2021]/1e6,1)
inc.cases.21.hi=round(global$inc.hi.num[global$year==2021]/1e6,1)

inc.cases.20=round(global$inc.num[global$year==2020]/1e6,1)
inc.cases.20.lo=round(global$inc.lo.num[global$year==2020]/1e6,1)
inc.cases.20.hi=round(global$inc.hi.num[global$year==2020]/1e6,1)

```


In `r yr`, the estimated number of people who fell ill with TB worldwide decreased year-on-year for the first time since the COVID-19 pandemic, reversing consecutive years of increases between 2020 and 2023 (`r lnk("Fig. 1.1.1")`, panel a). The TB incidence rate (new cases per `r cm` population per year) also fell, by `r round(100-(100*global$inc[global$year==yr]/global$inc[global$year==yr-1]),1)`% between 2023 and 2024 (`r lnk("Fig. 1.1.1")`, panel b), and is back to the level of 2020 (the historic low, pre-COVID).

Globally, the net reduction in the TB incidence rate from 2015 to `r yr` was `r 100-round(100*global$inc[global$year==yr]/global$inc[global$year==2015],1)`%, far from the WHO End TB Strategy milestone of a `r (1-inc.milestone.vs.2015)*100`% reduction by `r inc.mort.milestone.yr` (`r ref_lnk("1, 2")`).

### `r anch("Fig. 1.1.1")`<span class="red">Fig. 1.1.1</span> Global trends in the estimated number of incident TB cases (a) and the incidence rate (b), 2010&#8211;`r yr`
<div class="subhead">Shaded areas represent 95% uncertainty intervals. The horizontal dashed line shows the `r inc.mort.milestone.yr` milestone of the End TB Strategy, which is a `r (1-inc.milestone.vs.2015)*100`% reduction in the TB incidence rate between 2015 and `r inc.mort.milestone.yr`.</div>

```{r}



f1.1.1a <- 
  qplot(
    year,
    inc.num / 1e6,
    data = subset(global,year>=2010),
    geom = 'line',
    colour = I('blue')
  ) +
  geom_ribbon(
    aes(year, ymin = inc.lo.num / 1e6, ymax = inc.hi.num / 1e6),
    fill = I('blue'),
    alpha = 0.4
  ) +
  geom_line(aes(year, inc.h.num / 1e6), colour = I('lightskyblue2')) +
  geom_line(aes(year, c.newinc / 1e6)) +
  geom_ribbon(
    aes(year, ymin = inc.h.lo.num / 1e6, ymax = inc.h.hi.num / 1e6),
    fill = I('lightskyblue2'),
    alpha = 0.4
  ) +
  ylab('Millions per year') + xlab('') +
  annotate(
    'text',
    x = 2010,
    y = 7.9,
    label = 'Total',
    hjust = 0,
    size = I(4)
  ) +
  annotate(
    'text',
    x = 2015,
    y = 4.2,
    label = 'Case notifications of people \nnewly diagnosed with TB',
    hjust = 0,
    size = I(4)
  ) +
  annotate(
    'text',
    x = 2010,
    y = 0.9,
    label = 'People living with HIV',
    hjust = 0,
    size = I(4)
  ) +
  expand_limits(y = 1) +
  # scale_y_log10() +
  scale_x_continuous(breaks=seq(2010,2022,2)) +
  #scale_x_continuous(breaks=c(2010,2015,2019,2023)) +
  
  theme_bw(base_size = 14)+
  theme_gtb()


f1.1.1a_data=global[year>=2010,.(year,inc.num,inc.lo.num,inc.hi.num,inc.h.num,inc.h.lo.num,inc.h.hi.num,c.newinc)]

output_ggplot(f1.1.1a, f1.1.1a_data, show_static, pdf_csv_folder, save_csv, save_pdf)


## Fig1b

f1.1.1b <- 
  qplot(
    year,
    inc,
    data = subset(global,year>=2010),
    geom = 'line',
    colour = I('blue')
  ) +
  geom_ribbon(
    aes(year, ymin = inc.lo, ymax = inc.hi),
    fill = I('blue'),
    alpha = 0.4
  ) +
  geom_line(aes(year, inc.h), colour = I('lightskyblue2')) +
  geom_line(aes(year, newinc)) +
  geom_ribbon(
    aes(year, ymin = inc.h.lo, ymax = inc.h.hi),
    fill = I('lightskyblue2'),
    alpha = 0.4
  ) +
  geom_hline(aes(yintercept = inc.milestone), linetype = I(2)) +
  
  ylab('Rate per 100 000 population per year') + xlab('') +
  annotate(
    'text',
    x = 2020,
    y = 60,
    label = paste(inc.mort.milestone.yr, 'milestone'),
    hjust = 0,
    size = I(4)
  ) +
  annotate(
    'text',
    x = 2012,
    y = 190,
    label = 'Total',
    hjust = 0,
    size = I(4)
  ) +
  annotate(
    'text',
    x = 2010,
    y = 110,
    label = 'Case notifications of people \nnewly diagnosed with TB',
    hjust = 0,
    size = I(4)
  ) +
  annotate(
    'text',
    x = 2010,
    y = 10,
    label = 'People living with HIV',
    hjust = 0,
    size = I(4)
  ) +  
  expand_limits(y = 0) +
  # scale_y_log10() +
  scale_x_continuous(breaks=seq(2010,2022,2)) +
  theme_bw(base_size = 14)+
  theme_gtb()


f1.1.1b_data=global[year>=2010,.(year,inc,inc.lo,inc.hi,inc.h,inc.h.lo,inc.h.hi,newinc)]

output_ggplot(f1.1.1b , f1.1.1b_data, show_static, pdf_csv_folder, save_csv, save_pdf)


```


<div class="col-md-6">
#### (a) Number
<div id="fig_1_1_1a"></div>
</div>
<div class="col-md-6">
#### (b) Rate per `r cm` population
<div id="fig_1_1_1b"></div>
</div>

<hr />
<br />

The estimated increases in TB incidence between 2020 and 2023 were the consequence of disruptions to TB diagnosis and treatment during the COVID-19 pandemic, when the reported number of people newly diagnosed with TB fell from `r round(global$c.newinc[global$year==2019]/1e6,1)` million in 2019 to `r round(global$c.newinc[global$year==2020]/1e6,1)` million in 2020 and `r round(global$c.newinc[global$year==2021]/1e6,1)` million in 2021 (<span class="red">Section 2.1</span>). These reductions were assumed to have resulted in an increase in the number of people with undiagnosed and untreated TB, and subsequent increases in transmission.

The big global recovery in the reported number of people newly diagnosed with TB in 2022–`r yr` (<span class="red">Section 2.1</span>) has subsequently resulted in first a slowing of increases in TB incidence, and then a reversal of the upward trend.

In `r yr`, both the TB incidence rate and the estimated number of people who fell ill with TB have decreased, for the first time since the COVID-19 pandemic.

In `r yr`, `r f1.1.2_top |> nrow() |> int2word()` countries accounted for two thirds of global TB cases: `r f1.1.2_top[1,"country.in.text.EN"]` (`r ftb(f1.1.2_top[1,"pct"])`%), `r f1.1.2_top[2,"country.in.text.EN"]` (`r ftb(f1.1.2_top[2,"pct"])`%), `r f1.1.2_top[3,"country.in.text.EN"]` (`r ftb(f1.1.2_top[3,"pct"])`%), `r f1.1.2_top[4,"country.in.text.EN"]` (`r ftb(f1.1.2_top[4,"pct"])`%), `r f1.1.2_top[5,"country.in.text.EN"]` (`r ftb(f1.1.2_top[5,"pct"])`%), `r f1.1.2_top[6,"country.in.text.EN"]` (`r ftb(f1.1.2_top[6,"pct"])`%), `r f1.1.2_top[7,"country.in.text.EN"]` (`r ftb(f1.1.2_top[7,"pct"])`%) and `r f1.1.2_top[8,"country.in.text.EN"]` (`r ftb(f1.1.2_top[8,"pct"])`%) (`r lnk("Fig. 1.1.2")` and `r lnk("Fig. 1.1.3")`). 


### `r anch("Fig. 1.1.2")`<span class="red">Fig. 1.1.2</span> Estimated number of incident TB cases for countries with at least `r cm` incident cases, `r yr`

```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig_1.1.2, fig.alt="Estimated number of incident TB cases in 2023, for countries with at least 100 000 incident cases"} 

dta <- est[year == yr & inc.num > 1e5, .(iso3, size = inc.num)]
dta <- merge(dta, cty[,.(iso3, country)], by='iso3')

if (save_hidef == TRUE) {
  # Generate a high definition map for the PDF
  # Update fig numbering according to the masterlist of figs/tables
  f3_data <- dta

  f3_plot <- bubblemapper(f3_data, 
          legend_pos = "none", 
          legend_title = '',
          bubble_col = "#08519C",
          scale_limits = NULL,
          scale_breaks = NULL,
          scale_labels = NULL,
          hidef = save_hidef) 

  output_ggplot(f3_plot, f3_data, show_static, pdf_csv_folder, save_csv, save_pdf)
  
  } else {
  
    # Generate a standard map for the web page
    
    f1.1.2_plot <-
      
      bubblemapper(dta, 
          legend_pos = c(0.14, 0.5), 
          legend_title = 'Number of\nincident cases',
          bubble_col = "#08519C",
          scale_limits = c(100000, 3000000),
          scale_breaks = c(100000, 500000, 1000000, 2000000),
          scale_labels = c('100 000', '500 000','1 000 000', '2 000 000')) +
  
  add_annotate(geom='text', label='India', x=78, y=-6, size=2.5, include_coord = TRUE) +
  add_annotate('segment', x=81, xend=78, y=22.5, yend=-3.5, linewidth = 0.2) +
  
  add_annotate(geom='text', label='Pakistan', x=68, y=-1, size=2.5) +
  add_annotate('segment', x=70, xend=67, y=30.5, yend=1, linewidth = 0.2) +
  
  add_annotate('text', label='China', x=151, y=36, size=2.5) +
  add_annotate('segment',x=98, xend=145, y=36, yend=36, linewidth = 0.2) +
  
  add_annotate(geom='text', label='Bangladesh', x=152, y=31, size=2.5) +
  add_annotate('segment', x=91, xend=140, y=24, yend=31, linewidth = 0.2) +
  
  add_annotate(geom='text', label='Philippines', x=152, y=17, size=2.5) +
  add_annotate('segment', x=125, xend=142, y=8, yend=17, linewidth = 0.2) +
  
  add_annotate(geom='text', label='Indonesia', x=107, y=-16, size=2.5) +
  add_annotate('segment', x=113, xend=105, y=0, yend=-14, linewidth = 0.2) +
  
  add_annotate(geom='text', label='Nigeria', x=-11, y=0, size=2.5) +
  add_annotate('segment', x=8, xend=-4, y=9, yend=0, linewidth = 0.2) +
  
  #annotate(geom='text', label='South Africa', x=10, y=-45, hjust=0) +
  
  add_annotate(geom='text', label='Democratic\nRepublic\nof the Congo', x=-10, y=-20, size=2.5) +
  add_annotate('segment', x=23, xend=0, y=-4, yend=-20, linewidth = 0.2)  #+
  

output_ggplot(f1.1.2_plot, dta, show_static=TRUE, pdf_csv_folder, save_csv, save_pdf)

}

# #Proposed map
# 
# dta <- est[year==yr, .(iso3, inc.num, country)]
# dta$var <- cut(
#   dta$inc.num,
#   c(0, 100000, 500000, 1000000, 2000000, Inf),
#   c('0\u2013100 000', '100 000\u2013500 000', '500 000\u20131 000 000', '1 000 000\u20132 000 000','\u22652 000 000'),
#   right = F,
#   ordered_result = T
# )
# 
# whomapper(
#   X = dta, water_col = 'white',
#   legend_title =  "Estimated number of incident TB cases",
#   colours = brewer.pal(5, "BuPu"),
#   legend_pos = c(0.14, 0.34)
# )


```
<hr />



### `r anch("Fig. 1.1.3")`<span class="red">Fig. 1.1.3</span> Geographic distribution of the estimated number of incident TB cases in `r yr`
<div class="subhead">`r IDN_2_WPR_note2`</div>


```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig_1.1.3, fig.alt="Share of the number of incident TB cases in 2024"} 

#Treemap
library(treemapify)
library(ggplot2)

temp=est[year==2024, .(iso3,year,inc.num,pop,g.whoregion)]
dt_sorted=temp[order(-inc.num)]
total_inc_num <- sum(dt_sorted$inc.num, na.rm=T)
dt_sorted[, percent_contribution := (inc.num / total_inc_num) * 100]
dt_sorted[, cumulative_percent := cumsum(percent_contribution)]
#head(dt_sorted,n=10)

dt_group=head(dt_sorted,n=8)
dt_group$pop<-NULL
total_inc_num_top8 <- sum(dt_group$inc.num)

dt_group=rbind(dt_group,
               data.table(iso3="Rest of the world",year=2024,inc.num=total_inc_num-total_inc_num_top8,                                  g.whoregion="Rest",percent_contribution=100-dt_group$cumulative_percent[8],
                                   cumulative_percent=100-dt_group$cumulative_percent[8]))

dt_group=merge(dt_group,cty[,.(iso3,country)], by="iso3", all.x=T)
dt_group$country[dt_group$iso3=="Rest of the world"]="Rest of the world"

custom_region_labels <- c(
  "AFR" = "African Region",
  "EMR" = "Eastern Mediterranean Region",
  "Rest" = "Rest of the world", # Renamed "Rest" to "Other Regions"
  "SEA" = "South-East Asia Region",
  "WPR" = "Western Pacific Region"
)

f1.1.3_plot<-ggplot(dt_group, aes(area = inc.num, fill = g.whoregion,
                     label = country, subgroup = g.whoregion, subgroup2 = country)) +
  geom_treemap() +
  geom_treemap_text(colour = "black",
                    place = "centre",
                    size = 20,
                    grow = FALSE) +
  geom_treemap_subgroup_border(colour = "white", size = 5) +
  geom_treemap_subgroup2_border(colour = "white", size = 2) +
  scale_fill_brewer(palette = "Pastel1",
                    name = "WHO Region", # Change legend title
                    labels = custom_region_labels) # Apply custom labels to legend categories

output_ggplot(f1.1.3_plot, dt_group, show_static=TRUE, pdf_csv_folder, save_csv, save_pdf)


```


<hr />
<br />

The severity of national TB epidemics, in terms of the number of incident TB cases per `r cm` population in `r yr`, varies widely among countries: from less than ten to more than 500 cases per `r cm` population  (`r lnk("Fig. 1.1.4")`). 

In `r yr`, countries with the highest rates were mostly in the African Region, where `r count(est,year==yr & inc>=300 & g.whoregion=="AFR")[[2,2]]` countries had a rate of more than 300 per `r cm` population. There were `r count(est,year==yr & inc<10)[[2,2]]` countries with a low incidence of TB (<10 cases per `r cm` population), mostly in the WHO Region of the Americas and the European Region, plus a few countries in the WHO Eastern Mediterranean and Western Pacific regions.

### `r anch("Fig. 1.1.4")`<span class="red">Fig. 1.1.4 </span>Estimated TB incidence rates, `r yr`

```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig_1.1.4, fig.alt="Estimated TB incidence rates, 2024"} 


dta <- est[year==yr, .(iso3, inc, country)]
dta$var <- cut(
  dta$inc,
  c(0, 10, 50, 100, 300, 500, Inf),
  c('0\u20139.9', '10\u201349', '50\u201399', '100\u2013299', '300\u2013499', '\u2265500'),
  right = F,
  ordered_result = T
)


if (save_hidef == TRUE) {
  # Generate a high definition map for the PDF
  # Update fig numbering according to the masterlist of figs/tables
  f5_data <- dta
  
  f5_plot <- whomapper(
  X = f5_data, water_col = 'white',
  legend_title =  "",
  colours = brewer.pal(7, "Greens")[2:7],
  legend_pos = "none",
  hidef = save_hidef
  )
  
  output_ggplot(f5_plot, f5_data, show_static, pdf_csv_folder, save_csv, save_pdf)
  
} else {
  # Generate a standard map for the web page

f1.1.4_plot <- whomapper(
  X = dta, water_col = 'white',
  legend_title =  "Incidence\nper 100 000\npopulation per year",
  colours = brewer.pal(7, "Greens")[2:7],
  legend_pos = c(0.14, 0.40)
  )

output_ggplot(f1.1.4_plot, dta, show_static=TRUE, pdf_csv_folder, save_csv, save_pdf)

}

```


<hr />
<br />


```{r}
year_with_highest_tbhiv <- global$year[which.max(global$tbhiv)]
```


In `r yr`, the global proportion of people with a new episode of TB (either new or recurrent cases) who were living with HIV was `r round(100*global$tbhiv[global$year==yr],1)`% (95% UI: `r round(100*global$tbhiv.lo[global$year==yr],1)`.0&#8211;`r round(100*global$tbhiv.hi[global$year==yr],1)`%) and was highest in countries in the WHO African Region, exceeding 50% in parts of southern Africa (`r lnk("Fig. 1.1.5")`). The proportion has been falling for many years, following a peak at `r round(100*global$tbhiv[global$year==year_with_highest_tbhiv],0)`% in `r year_with_highest_tbhiv`.

### `r anch("Fig. 1.1.5")`<span class="red">Fig. 1.1.5</span> Estimated HIV prevalence in people with a new episode of TB (new or recurrent cases), `r yr`

```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig_1.1.5, fig.alt="Estimated HIV prevalence in people with new or recurrent TB, 2024"} 


dta <- est[year==yr, .(iso3, tbhiv)]
dta$var <- cut(
  dta$tbhiv * 100,
  c(0, 5, 10, 20, 50, Inf),
  c('0\u20134.9', '5\u20139.9', '10\u201319', '20\u201349', '\u226550'),
  right = F,
  ordered_result = T
)

f1.1.5_plot <- whomapper(
  X = dta, water_col = 'white',
  colours = brewer.pal(5, "Reds"),
  legend_pos = c(0.14, 0.34),
  legend_title =  "HIV prevalence,\nall ages (%)"
  ) 

output_ggplot(f1.1.5_plot, dta, show_static=TRUE, pdf_csv_folder, save_csv, save_pdf)

```


<hr /> 
<br />

TB can affect anyone, regardless of age or sex (`r lnk("Fig. 1.1.6")`). The highest burden is in adult men (aged &#8805;15 years), with an estimated  `r round(inc.men/1e6,1)` million cases (95% UI: `r round(inc.men.lo/1e6,1)`–`r round(inc.men.hi/1e6,1)` million) in `r yr`, equivalent to  `r round(100*inc.men/global$inc.num[global$year==yr],0)`% of the estimated total; by comparison, there were an estimated `r round(inc.women/1e6,1)` million cases (95% UI: `r round(inc.women.lo/1e6,1)`–`r round(inc.women.hi/1e6,1)` million) among adult women (aged &#8805;15 years), equivalent to `r round(100*inc.women/global$inc.num[global$year==yr],0)`% of the estimated total, and `r round(inc.child/1e6,1)` million (95% UI: `r round(inc.child.lo/1e6,2)`–`r round(inc.child.hi/1e6,1)` million) cases among children (aged 0–14 years), equivalent to `r round(100*inc.child/global$inc.num[global$year==yr],0)`% of the estimated total. 

Case notifications of people newly diagnosed with TB in `r yr` were `r round(100*global$c.newinc[global$year==yr]/global$inc.num[global$year==yr],0)`% of the estimated TB incidence overall, with the same figures for adult men and women (`r round(100*sum(globsplt$newrel[globsplt$sex=="M"& globsplt$age %ni% c("0-4","5-14") ])/sum(globsplt$inc[globsplt$sex=="M"& globsplt$age %ni% c("0-4","5-14")]),0)`%). The figure was much lower for children aged 0–14 years (`r round(100*sum(globsplt$newrel[globsplt$age %in% c("0-4","5-14")])/sum(globsplt$inc[globsplt$age %in% c("0-4","5-14")]),0)`%) and lower still for children aged <5 years (`r round(100*sum(globsplt$newrel[globsplt$age=="0-4"])/sum(globsplt$inc[globsplt$age=="0-4"]),0)`%). 

Global estimates of TB incidence during pregnancy and postpartum will be published later this year.

### `r anch("Fig. 1.1.6")`<span class="red">Fig. 1.1.6</span> Global estimates of TB incidence (absolute numbers) disaggregated by age group and sex, compared with case notifications (female in <span style="color:#6363C0">purple</span>; male in <span style="color:#F4A81D">orange</span>), `r yr`

<div class="subhead"> Bars show TB notifications. Dots and error bars show best estimates of incidence and 95% uncertainty intervals, respectively.</div>


```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig_1.1.6, fig.alt="Global estimates of TB incidence numbers and case notifications disaggregated by age and sex (female in purple; male in orange), 2024 "} 
# 
# absspace <- function(x,...) {             #works
#      format(abs(x), ..., big.mark=" ",scientific = FALSE, trim = TRUE)
#  }
#  
#  ## ages and colors etc -- From Pete, with a minor edit
#  agz3 <- c('0\u20134',
#            '5\u201314',
#            '15\u201324',
#            '25\u201334',
#            '35\u201344',
#            '45\u201354',
#            '55\u201364',
#            '65plus') #for labels
#  agz4 <- c(rev(rev(agz3)[-1]), "\u226565")
#  clz <- c('F' = palette_gtb('female'),
#           'M' = palette_gtb('male'))
#  ## plot construction
#  f1.1.5_plot  <- ggplot(data = globsplt, aes(x = age, y = newrel, fill = sex)) +
#    coord_flip() +
#    geom_bar(stat = 'identity', aes(y = ifelse(sex == 'M',
#                                               newrel,
#                                               -newrel))) +
#    scale_fill_manual(values = clz) +
#    geom_bar(stat = 'identity',
#             fill = 'transparent',
#             col = 1,
#             aes(y = ifelse(sex == 'M',
#                            inc,
#                            -inc))) +
#    theme_gtb(axis_text_size = 12) +
#    theme(legend.position = "none") + xlab('Age group (years)') + ylab('Number of TB cases') +
#    scale_x_discrete(labels = agz4) +
#    scale_y_continuous(labels = absspace) +
#    theme(axis.title.y = element_text(margin = margin(r = 15))) 
#  
# output_ggplot(f1.1.5_plot, globsplt, show_static, pdf_csv_folder, save_csv, save_pdf=FALSE, save_cairo=TRUE)
# 
# # Produce the alternative ggplot2 version with estimates as horizontal ribbons with uncertainty intervals 
# # (one for each sex) and without showing notifications. This will be used in the main report PDF as Figure 4.
# #
# # Use the db_estimates_group data table because that also contains disaggregations by age group and sex
# 
# FIG.4_data <- db_estimates_group |> 
#   dplyr::filter(group_type=="global" & 
#                   year == 2023 & 
#                   measure == "inc" & 
#                   unit == "num" & 
#                   sex %in% c("m", "f") & 
#                   age_group %in% c("0-4", "5-14", "15-24", "25-34", "35-44", "45-54", "55-64", "65plus")) |> 
#   dplyr::select(age_group, sex, best, lo, hi)
# 
# FIG.4_data$age_group <- factor(FIG.4_data$age_group,
#                                levels=c("0-4", "5-14", "15-24", "25-34", "35-44", "45-54", "55-64", "65plus"),
#                                labels=c("0\u20134", "5\u201314", "15\u201324", "25\u201334", "35\u201344", "45\u201354", "55\u201364", "\u226565"))
# 
# sex_colours <-  c("f" = gtbreport::palette_gtb("female"), "m" = gtbreport::palette_gtb("male"))
# sex_names <- c("Females", "Males") 
# 
# FIG.4_plot <- FIG.4_data |> 
#   
#   ggplot() + 
#   
#   geom_line(aes(x=age_group, y=best, group=sex, colour=sex), size=1) +
#   
#   geom_ribbon(aes(x=age_group, ymin=lo, ymax=hi, group=sex, fill = sex), alpha = 0.4) +
#   
#   scale_colour_manual(values = sex_colours, labels = sex_names) +
#   
#   scale_fill_manual(values = sex_colours, labels = sex_names) +
#   
#   # display y-axis scale in millions
#   scale_y_continuous(name = "Number of TB cases (millions)", 
#                      limits = c(0, 1.4e6),
#                      # Use the remainder operator in the labeller function to make sure we don't get weird effects
#                      # when plotting small numbers
#                      labels = function(i){ifelse((i/1e6) %% 1 == 0, round(i/1e6), round(i/1e6, 1))}) +
# 
#   xlab("Age group (years)") +
#   
#   theme_gtb()  +
#   
#   theme(legend.position = "none") +
#   
#   # Get rid of annoying x-axis line 
#   theme(axis.line.x = ggplot2::element_blank())
# 
# output_ggplot(FIG.4_plot, FIG.4_data, show_static, pdf_csv_folder, save_csv, save_pdf=FALSE, save_cairo=TRUE)


```


<div class="col-md-6">
#### (a) Female
<div id="fig_1_1_5a"></div>
</div>
<div class="col-md-6">
#### (b) Male
<div id="fig_1_1_5b"></div>
</div>

Regional estimates of the distribution of incident TB cases, disaggregated by age and sex and compared with case notifications, are shown in `r lnk("Fig. 1.1.7")`. The largest numbers are typically in the age groups of 25–34, 35–44 or 45–54 years. The WHO Western Pacific Region is an exception, with the largest number of cases in the age group &#8805;65 years; this is mostly influenced by numbers for China and can be explained by the country’s aging population and declining burden of TB disease (with higher rates of infection and a higher risk of new cases arising from reactivation of previous infections among older people). 

### `r anch("Fig. 1.1.7")`<span class="red">Fig. 1.1.7</span> Regional estimates of TB incidence (absolute numbers) disaggregated by age group and sex, compared with case notifications (female in <span style="color:#6363C0">purple</span>; male in <span style="color:#F4A81D">orange</span>), `r yr`
<div class="subhead">`r IDN_2_WPR_note2`</div>


```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig.height=10, fig_1.1.7, fig.alt="Regional estimates of TB incidence numbers and case notifications disaggregated by age and sex, 2024"} 
# 
# agz3 <- c('0\u20134',
#            '5\u201314',
#            '15\u201324',
#            '25\u201334',
#            '35\u201344',
#            '45\u201354',
#            '55\u201364',
#            '65plus') #for labels
#  agz4 <- c(rev(rev(agz3)[-1]), "\u226565")
#  clz <- c('F' = palette_gtb('female'),
#           'M' = palette_gtb('male'))
#  
# f1.1.7_plot <- ggplot(data = regsplt, aes(x = age, y = newrel/1000, fill = sex)) +
#    coord_flip() +
#    geom_bar(stat = 'identity', aes(y = ifelse(sex == 'M',
#                                               newrel/1000,
#                                               -newrel/1000))) +
#    scale_fill_manual(values = clz) +
#    geom_bar(stat = 'identity',
#             fill = 'transparent',
#             col = 1,
#             aes(y = ifelse(sex == 'M',
#                            inc/1000,
#                            -inc/1000))) +
#    xlab('Age group (years)') + ylab('') +
#    scale_x_discrete(labels = agz4) +
#    scale_y_continuous(labels = absspace) +
#      facet_wrap(
#      ~ name,
#      scales = 'free',
#      ncol= 3,
#      labeller = label_wrap_gen(width = 25)
#    ) +
#    theme_gtb() +
#    theme(legend.pos = 'none')
# 
# output_ggplot(f1.1.7_plot, regsplt, show_static, pdf_csv_folder, save_csv, save_pdf=FALSE, save_cairo=TRUE)


```


<div class="row">

<div class="col-md-6">
#### (a) Female
<div id="fig_1_1_6a_AFR"></div>
<div id="fig_1_1_6a_AMR"></div>
<div id="fig_1_1_6a_EMR"></div>
<div id="fig_1_1_6a_EUR"></div>
<div id="fig_1_1_6a_SEA"></div>
<div id="fig_1_1_6a_WPR"></div>
</div>
	
<div class="col-md-6">
#### (b) Male
<div id="fig_1_1_6b_AFR"></div>
<div id="fig_1_1_6b_AMR"></div>
<div id="fig_1_1_6b_EMR"></div>
<div id="fig_1_1_6b_EUR"></div>
<div id="fig_1_1_6b_SEA"></div>
<div id="fig_1_1_6b_WPR"></div>
</div>
	
</div>


<hr />
<br />


Regional trends in TB incidence rates vary, and progress in relation to the `r inc.mort.milestone.yr` milestone of the End TB Strategy is mixed (`r lnk("Fig. 1.1.8")`).


### `r anch("Fig. 1.1.8")`<span class="red">Fig. 1.1.8</span> Trends in estimated TB incidence rates by WHO region, 2010&#8211;`r yr`
<div class="subhead">The overall TB incidence rate is shown in <span style="color:#91A93E">green</span> and the incidence rate among people living with HIV is shown in <span style="color:#ED1D24">red</span>. The black solid lines show case notifications of people newly diagnosed with TB, for comparison with estimates of the overall incidence rate. Shaded areas represent 95% uncertainty intervals. The horizontal dashed line shows the `r inc.mort.milestone.yr` milestone of the End TB Strategy, which is a `r (1-inc.milestone.vs.2015)*100`% reduction in the TB incidence rate between 2015 and `r inc.mort.milestone.yr`. `r IDN_2_WPR_note` </div> 
```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig.height=8,  fig_1.1.8, fig.alt="Trends in estimated TB incidence rates by WHO region, 2000-2024"} 

f1.1.8_plot <- qplot(year,
      inc,
      data = subset(regional,year>=2010),
      geom = 'line',
      colour = I('blue')) +
  geom_line(aes(year, inc.h), colour = I('lightskyblue2')) +
  geom_ribbon(aes(year, ymin = inc.h.lo, ymax = inc.h.hi),
              fill = I('lightskyblue2'),
              alpha = 0.4) +
  geom_ribbon(aes(year, ymin = inc.lo, ymax = inc.hi),
              fill = I('blue'),
              alpha = 0.4) +
  geom_line(aes(year, newinc)) +
  geom_hline(aes(yintercept = inc.milestone), linetype = I(2)) +
  facet_wrap(~ region, scale = 'free_y') +
  xlab('') + ylab('Incidence rate per 100 000 population per year') +
  expand_limits(y=1) +
  theme_bw(base_size = 12) +
  #  scale_y_continuous(trans='log10', breaks=c(1,2,5,10,20,30,50,100,200,300)) +
 # scale_y_log10() +
  scale_x_continuous(breaks=c(2010,2015,2020)) +
  theme_gtb() +
  theme(legend.position = 'none') 

output_ggplot(f1.1.8_plot, subset(regional,year>=2010), show_static, pdf_csv_folder, save_csv, save_pdf)


```


<div class="row">
<div class="col-md-4">
<div id="fig_1_1_7_AFR"></div>
<div id="fig_1_1_7_EUR"></div>
</div>
	
<div class="col-md-4">
<div id="fig_1_1_7_AMR"></div>
<div id="fig_1_1_7_EMR"></div>
</div>
	
<div class="col-md-4">
<div id="fig_1_1_7_SEAR"></div>
<div id="fig_1_1_7_WPR"></div>
</div>
</div>

<hr />
<br />




In `r yr`, the TB incidence rate increased for the fourth consecutive year in the Region of the Americas, reflecting the estimated impact of shortfalls in TB case detection in 2020 and a still incomplete recovery by 2024. An upward trend in 2020–2023 was reversed in 2024 in the Western Pacific Region. In two regions, the Eastern Mediterranean Region and the South-East Asia Region, the TB incidence rate decreased for the second consecutive year, reinforcing the 2023 reversal of the 2020–2022 COVID-related upward trend. In the European Region, the TB incidence rate had been falling since 2022. In the African Region, the decline in the TB incidence rate that has been sustained for many years continued in `r yr`.

The biggest estimated reduction in the TB incidence rate since the End TB Strategy baseline year of 2015 has been in the European Region, with a net reduction of `r round(100-100*regional$inc[regional$year==yr & regional$g.whoregion=="EUR"]/regional$inc[regional$year==2015 & regional$g.whoregion=="EUR"],0)`% by `r yr`. This was mainly driven by progress in the Russian Federation. A large reduction has also been achieved in the African Region, with a `r round(100-100*regional$inc[regional$year==yr & regional$g.whoregion=="AFR"]/regional$inc[regional$year==2015 & regional$g.whoregion=="AFR"],0)`% decline by `r yr`. In the South-East Asia Region, the decline was `r round(100-100*regional$inc[regional$year==yr & regional$g.whoregion=="SEA"]/regional$inc[regional$year==2015 & regional$g.whoregion=="SEA"],0)`%. The net decline in `r yr` compared with 2015 was relatively small in the Eastern Mediterranean Region (`r round(100-100*regional$inc[regional$year==yr & regional$g.whoregion=="EMR"]/regional$inc[regional$year==2015 & regional$g.whoregion=="EMR"],1)`%).



Between 2015 and `r yr`, there was a net increase in TB incidence in two regions: the Western Pacific (up `r round(100*regional$inc[regional$year==yr & regional$g.whoregion=="WPR"]/regional$inc[regional$year==2015 & regional$g.whoregion=="WPR"]-100,1)`%) and more noticeably, the Region of the Americas (up `r round(100*regional$inc[regional$year==yr & regional$g.whoregion=="AMR"]/regional$inc[regional$year==2015 & regional$g.whoregion=="AMR"]-100,0)`%).


Trends in TB incidence rates by income group are shown in (`r lnk("Fig. 1.1.9")`).


### `r anch("Fig. 1.1.9")`<span class="red">Fig. 1.1.9</span> Trends in estimated TB incidence rates by income group, 2010&#8211;`r yr`

<div class="subhead">TB incidence rates are shown in <span style="color:#91A93E">green</span> and the incidence rate among people living with HIV is shown in <span style="color:#ED1D24">red</span>. The black solid lines show notifications of new and recurrent cases for comparison with estimates of the total incidence rate. Shaded areas represent 95% uncertainty intervals.</div> 


```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig.height=8,  fig_1.1.9, fig.alt="Trends in estimated TB incidence rates by WHO region, 2000-2024"} 

f1.1.9_plot <- qplot(year,
      inc,
      data = subset(income,year>=2010),
      geom = 'line',
      colour = I('blue')) +
  geom_line(aes(year, inc.h), colour = I('lightskyblue2')) +
  geom_ribbon(aes(year, ymin = inc.h.lo, ymax = inc.h.hi),
              fill = I('lightskyblue2'),
              alpha = 0.4) +
  geom_ribbon(aes(year, ymin = inc.lo, ymax = inc.hi),
              fill = I('blue'),
              alpha = 0.4) +
  geom_line(aes(year, newinc)) +
  facet_wrap(~ group, scale = 'free_y') +
  xlab('') + ylab('Incidence rate per 100 000 population per year') +
  expand_limits(y=1) +
  theme_bw(base_size = 12) +
  #  scale_y_continuous(trans='log10', breaks=c(1,2,5,10,20,30,50,100,200,300)) +
 # scale_y_log10() +
  scale_x_continuous(breaks=c(2010,2015,2020)) +
  theme_gtb() +
  theme(legend.position = 'none') 

output_ggplot(f1.1.9_plot, subset(income,year>=2010), show_static, pdf_csv_folder, save_csv, save_pdf)


```



<div class="row">
<div class="col-md-6">
<div id="fig_1_1_8_LIC"></div>
<div id="fig_1_1_8_LMC"></div>
</div>
	
<div class="col-md-6">
<div id="fig_1_1_8_UMC"></div>
<div id="fig_1_1_8_HIC"></div>
</div>
</div>

<hr />
<br />



```{r}
dta <- subset(est, year==yr, select=c("iso3","country","year","inc"))
dta_2015 <- subset(est, year==2015, select=c("iso3","inc"))
setnames(dta_2015, "inc", "inc.2015")
dta <- merge(dta, dta_2015, by="iso3")
rm(dta_2015)

dta$rel.red.inc=(1-(dta$inc/dta$inc.2015))*100
dta$rel.red.inc.cat=ifelse(dta$rel.red.inc>0,"Reduction","Increase")

dta$rel.red.inc.fordisplay=ifelse(dta$rel.red.inc<0,
                                      -round(dta$rel.red.inc,1),
                                      round(dta$rel.red.inc,1))

dta$var <- cut(
  dta$rel.red.inc,
  c(-Inf,-5,5, 10, 20, 50,Inf),
  c("Increase (>5%)",'Stable (-5% to +5%)', 'Decrease (6\u20139%)', 'Decrease (10\u201319%)', 'Decrease (20\u201349%)','Decrease (\u226550%)'),
  right = F,
  ordered_result = T
)

dta=merge(dta,cty[,.(iso3,g.whostatus,g.whoregion)],by="iso3")
reach.milestone.lst=dta[var=="Decrease (≥50%)" & g.whostatus=="M",unique(iso3)]
n.reach.milestone=length(reach.milestone.lst)

reach.20pct=dta[(var=="Decrease (≥50%)" | var=="Decrease (20–49%)") & g.whostatus=="M",unique(iso3)]
n.reach.20pct=length(reach.20pct)


reach.20pct.afreur=dta[(var=="Decrease (≥50%)" | var=="Decrease (20–49%)") & g.whostatus=="M" & (g.whoregion=="AFR" | g.whoregion=="EUR"),unique(iso3)]
n.reach.20pct.afreur=length(reach.20pct.afreur)

incr.5pct=dta[var=="Increase (>5%)" & g.whostatus=="M",unique(iso3)]
n.incr.5pct=length(incr.5pct)


```



Progress in reducing the TB incidence rate at country level is highly variable (`r lnk("Fig. 1.1.10")`). In total, `r n.reach.20pct` countries (including `r n.reach.20pct.afreur` in the European and African regions) achieved estimated reductions of more than 20% between 2015 and `r yr`, thus surpassing the first (2020) milestone of the End TB Strategy; and `r n.reach.milestone` countries are estimated to have achieved reductions of at least 50% between 2015 and `r yr`, including one high TB burden country (South Africa). At the other extreme, there are `r n.incr.5pct` countries where the TB incidence rate in `r yr` was more than 5% higher than in 2015. These countries are most noticeably in the Region of the Americas but also include three high TB burden countries in Asia: Indonesia, Myanmar and the Philippines. 





### `r anch("Fig. 1.1.10")`<span class="red">Fig. 1.1.10</span> Change (%) in the estimated TB incidence rate (new cases per `r cm` population per year), `r yr` compared with 2015

<div class="subhead">The first milestone of the End TB Strategy was a 20% reduction by 2020, compared with 2015; the second milestone is a 50% reduction by 2025, compared with 2015. The last two categories (decrease 20&#8211;49%, and decrease &#8805;50%) distinguish the countries that have made the most progress towards the second milestone of the End TB Strategy.</div>

```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig_1.1.10, fig.alt="Change in TB incidence between 2015 and 2024"} 

if (save_hidef == TRUE) {
  # Generate a high definition map for the PDF
  # Update fig numbering according to the masterlist of figs/tables
  f13_data <- dta
  
  f13_plot <- whomapper(
  X = f13_data, water_col = 'white',
  legend_title = "",
  legend_pos = "none",
  colours = c("lightyellow2", "lightyellow3", brewer.pal(5, "Purples")[2:5]),
  hidef = save_hidef
)
  
  output_ggplot(f13_plot, f13_data, show_static, pdf_csv_folder, save_csv, save_pdf)
  
} else {

# f1.1.10_plot <- whomapper(
#   X = dta, water_col = 'white',
#   legend_title = paste0("Change (", yr, " vs 2015, %)"),
#   legend_pos = c(0.14, 0.34),
#   colours = c("lightyellow2","lightyellow3",brewer.pal(4, "Purples"))
# )
# 

f1.1.10_plot <- whomapper(
  X = dta, water_col = 'white',
  legend_title = paste0("Change (", yr, " vs 2015, %)"),
  legend_pos = c(0.14, 0.34),
  # Request 9 colors and take colors 6 through 9 (the darkest 4)
  colours = c("lightyellow2", "lightyellow3", brewer.pal(5, "Purples")[2:5])
)
output_ggplot(f1.1.10_plot, dta, show_static=TRUE, pdf_csv_folder, save_csv, save_pdf)

}

```


<hr />
<br />

Trends in the TB incidence rate in the 30 high TB burden countries are also highly variable (`r lnk("Fig. 1.1.11")`). In `r yr`, the best estimate of the TB incidence rate suggested that the 2025 milestone of the End TB Strategy had been reached in South Africa and was close to being reached in Kenya, the United Republic of Tanzania and Zambia.


### `r anch("Fig. 1.1.11")`<span class="red">Fig. 1.1.11</span> Trends in estimated TB incidence rates in the 30 high TB burden countries compared with notifications of new and recurrent cases, 2010&#8211;`r yr`
<div class="subhead">TB incidence rates are shown in <span style="color:#91A93E">green</span>. The black solid lines show notifications of new and recurrent cases for comparison with estimates of the total incidence rate. Shaded areas represent 95% uncertainty intervals. The horizontal dashed line shows the `r inc.mort.milestone.yr` milestone of the End TB Strategy, which is a `r (1-inc.milestone.vs.2015)*100`% reduction between 2015 and `r inc.mort.milestone.yr`.</div> 

```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig.height=12, fig_1.1.11, fig.alt="Trends in estimated TB incidence rates in the 30 high TB burden countries compared with notifications of new and recurrent cases, 2010−2023"} 


f1.1.11_plot <- qplot(year,
      inc,
      data = subset(hest,year>=2010),
      geom = 'line',
      colour = I('blue')) +
  geom_ribbon(aes(year, ymin = inc.lo, ymax = inc.hi),
              fill = I('blue'),
              alpha = 0.4) +
  geom_line(aes(year, newinc)) +
  geom_hline(aes(yintercept = inc.milestone), linetype = I(2)) +
  #facet_wrap(~ country, scales = 'free_y', ncol = 5) +
  facet_wrap(~country, nrow=6, scales="free",
                     # Use the labeller function to make sure long country names are wrapped in panel headers
                     labeller = label_wrap_gen(width = 25)) +
#  expand_limits(y = 1) +
  xlab('') + ylab('Incidence rate per 100 000 population per year') +
 # scale_y_log10() +
  scale_x_continuous(breaks=c(2010,2015,2020)) +
  theme_gtb()


output_ggplot(f1.1.11_plot, subset(hest,year>=2010), show_static, pdf_csv_folder, save_csv, save_pdf)

```

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_AGO"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_BGD"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_BRA"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_CAF"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_CHN"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_COG"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_PRK"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_COD"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_ETH"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_GAB"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_IND"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_IDN"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_KEN"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_LSO"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_LBR"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_MNG"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_MOZ"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_MMR"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_NAM"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_NGA"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_PAK"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_PNG"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_PHL"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_SLE"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_ZAF"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_THA"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_UGA"></div>
</div>
</div>

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_9_TZA"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_VNM"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_9_ZMB"></div>
</div>
</div>
<div class="footnote">Incidence estimates are not shown for the Democratic People’s Republic of Korea, since they are currently under review.</div>


<hr />
<br />

In `r yr`, the estimated TB incidence rate continued to decrease in all three global TB watchlist countries. The Russian Federation is close to reaching the 2025 milestone of the End TB Strategy (`r lnk("Fig. 1.1.12")`). 


### `r anch("Fig. 1.1.12")`<span class="red">Fig. 1.1.12</span> Trends in estimated TB incidence rates in the three global TB watchlist countries compared with notifications of new and recurrent cases, 2010&#8211;`r yr`
<div class="subhead">TB incidence rates are shown in <span style="color:#91A93E">green</span>. The black solid lines show notifications of new and recurrent cases for comparison with estimates of the total incidence rate. Shaded areas represent 95% uncertainty intervals. The horizontal dashed line shows the `r inc.mort.milestone.yr` milestone of the End TB Strategy, which is a `r (1-inc.milestone.vs.2015)*100`% reduction between 2015 and `r inc.mort.milestone.yr`.</div> 
```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig.height=2.7, fig.width=8, fig.align='left', fig_1.1.12, fig.alt="Trends in estimated TB incidence rates in the 3 WHO watchlist countries compared with notifications of new and recurrent cases, 2010−2023"} 

dta <- est[iso3 %in% c('KHM','RUS','ZWE')]

f1.1.12_plot <- qplot(year,
      inc,
      data = subset(dta,year>=2010),
      geom = 'line',
      colour = I('blue')) +
  geom_ribbon(aes(year, ymin = inc.lo, ymax = inc.hi),
              fill = I('blue'),
              alpha = 0.4) +
  geom_line(aes(year, newinc)) +
  geom_hline(aes(yintercept = inc.milestone), linetype = I(2)) +
  #facet_wrap(~ country, scales = 'free_y', ncol = 5) +
  facet_wrap(~country, nrow=1, scales="free",
                     # Use the labeller function to make sure long country names are wrapped in panel headers
                     labeller = label_wrap_gen(width = 25)) +
#  expand_limits(y = 1) +
  xlab('') + ylab('Incidence rate per 100 000\npopulation per year') +
 # scale_y_log10() +
  scale_x_continuous(breaks=c(2010,2015,2020)) +
  theme_gtb()

output_ggplot(f1.1.12_plot, subset(dta,year>=2010), show_static, pdf_csv_folder, save_csv, save_pdf)


```

<div class="row">
<div class="col-md-4">
<div id="fig_1_1_10_KHM"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_10_RUS"></div>
</div>
<div class="col-md-4">
<div id="fig_1_1_10_ZWE"></div>
</div>
</div>

<hr />
<br />


`r lnk("Box 1.1.1")` provides a summary of the methods used to produce estimates of TB incidence for the period 2010–2024. 

`r anch("Box 1.1.1")`



```{r}

load(here("inc_mort/analysis/est.method.rda"))

est.meth.inc=est.method[,.(iso3,method.inc)]

est.meth.inc[iso3=="BRA", method.inc:=991]
est.meth.inc[iso3 %in% c("COD","BFA","CAF","GNQ","SLE","SSD"), method.inc:=992]

compact.lst=est[c.newinc<10, unique(iso3)]
est.meth.inc[iso3 %in% compact.lst, method.inc:=993]

est.meth.inc[iso3 %in% c("RUS","MDA","KAZ"), method.inc:=994]
est.meth.inc[iso3 %in% c("ALB","GTM","MAR","SAU"), method.inc:=995]


est.meth.inc= est.meth.inc %>% mutate(
  var=case_when(
  method.inc>=1 & method.inc<=3 ~ "Case notifications and UHC SCI",
  method.inc>=4 & method.inc<=6 ~ "Case notifications and UHC SCI with statistical model",
  method.inc>=7 & method.inc<=9 ~ "National TB prevalence survey",
  method.inc>=10 & method.inc<=12 ~ "National TB inventory study",
  method.inc==991 ~ "Case notifications combined with TB mortality data",
  method.inc==992 ~ "Country-specific customized approach",
  method.inc==993 ~ "Case notifications with no adjustment",
  method.inc==994 ~ "Case notifications with no adjustment",
  method.inc==995 ~ "Case notifications with standard adjustment",
)
)

n.tbps=sum(est.meth.inc$var=="National TB prevalence survey",na.rm=T)-1

n.is=sum(est.meth.inc$var=="National TB inventory study",na.rm=T)
n.uhc.dir=sum(est.meth.inc$var=="Case notifications and UHC SCI",na.rm=T)
n.uhc.indir=sum(est.meth.inc$var=="Case notifications and UHC SCI with statistical model",na.rm=T)

n.spe.991=sum(est.meth.inc$var=="Case notifications combined with TB mortality data",na.rm=T)
n.spe.992=sum(est.meth.inc$var=="Country-specific customized approach",na.rm=T)

n.spe.99.small=sum(est.meth.inc$var=="Case notifications with no adjustment" & est.meth.inc$method.inc==993,na.rm=T)
n.spe.99.noadj=sum(est.meth.inc$var=="Case notifications with no adjustment" & est.meth.inc$method.inc==994,na.rm=T)
n.spe.99.stdadj=sum(est.meth.inc$var=="Case notifications with standard adjustment" & est.meth.inc$method.inc==995,na.rm=T)



cm.lst=unique(est.meth.inc$iso3[est.meth.inc$method.inc==2 | est.meth.inc$method.inc==5 |
                                est.meth.inc$method.inc==8 | est.meth.inc$method.inc==11])

rm.lst=unique(est.meth.inc$iso3[est.meth.inc$method.inc==3 | est.meth.inc$method.inc==6 |
                                est.meth.inc$method.inc==9 | est.meth.inc$method.inc==12])



# Share in 2024
est19=merge(est.full[year==2019,.(iso3,inc.num)],est.meth.inc[,.(iso3,var,method.inc)],by="iso3")
est24=merge(est.full[year==2024,.(iso3,inc.num)],est.meth.inc[,.(iso3,var,method.inc)],by="iso3")

inc19=global$inc.num[global$year==2019]
inc24=global$inc.num[global$year==2024]

share.tbps=round(100*sum(est24$inc.num[est24$var=="National TB prevalence survey" & est24$iso3 !="IND"],na.rm=T)/inc24,0)

share.ind=round(100*sum(est24$inc.num[est24$iso3 =="IND"],na.rm=T)/inc19,0)

share.uhc.dir=round(100*sum(est24$inc.num[est24$var=="Case notifications and UHC SCI"],na.rm=T)/inc19,1)
share.uhc.indir=round(100*sum(est24$inc.num[est24$var=="Case notifications and UHC SCI with statistical model"],na.rm=T)/inc19,1)

share.is=round(100*sum(est24$inc.num[est24$var=="National TB inventory study"],na.rm=T)/inc19,0)

share.spe=round(100*sum(est24$inc.num[est24$var=="Country-specific customization"],na.rm=T)/inc19,1)

share.spe.991=round(100*sum(est24$inc.num[est24$var=="Case notifications combined with TB mortality data"],na.rm=T)/inc19,1)

share.spe.992=round(100*sum(est24$inc.num[est24$var=="Country-specific customized approach"],na.rm=T)/inc19,1)

share.spe.993=round(100*sum(est24$inc.num[est24$var=="Case notifications with no adjustment" & est24$method.inc==993],na.rm=T)/inc19,1)

share.spe.994=round(100*sum(est24$inc.num[est24$var=="Case notifications with no adjustment" & est24$method.inc==994],na.rm=T)/inc19,1)

share.spe.995=round(100*sum(est24$inc.num[est24$var=="Case notifications with standard adjustment" & est24$method.inc==995],na.rm=T)/inc19,1)

share.cm=round(100*sum(est24$inc.num[est24$iso3 %in% cm.lst],na.rm=T)/inc24,0)
share.rm=round(100*sum(est24$inc.num[est24$iso3 %in% rm.lst],na.rm=T)/inc24,1)


```



<div class="textbox">
## Box 1.1.1 

## Methods used by WHO to estimate TB incidence 

The main methods used by WHO to estimate TB incidence at country level in the period 2010–`r yr` are shown in `r lnk("Fig. 1.1.13")`. These methods adhere to global guidelines for accurate and transparent reporting of health estimates (`r ref_lnk("3")`) and are described in detail in a <span class="red">technical appendix</span>. Updates to methods used for this report are explained in <span class="red">Annex 4</span> of the core report document. The main update for this report is use of country-specific values for the Universal Health Coverage Service Coverage Index (UHC SCI) in combination with TB notification data to produce incidence estimates for `r n.uhc.dir+n.uhc.indir` countries that collectively accounted for `r share.uhc.dir+share.uhc.indir`% of global incident cases in 2024.

Methods used by WHO to estimate TB incidence for 2010–2024 included: 

* Results from national TB prevalence surveys combined with estimates of the duration of disease, used for `r n.tbps` countries with `r share.tbps`% of the global number of incident TB cases in `r yr`;

* Results from a national TB prevalence survey combined with a country-specific dynamic model that was calibrated to survey data as well as other data (e.g. notifications, drug sales) and WHO TB mortality estimates. This was used for India, which had `r share.ind`% of the global number of incident TB cases in `r yr` (for further details, see the <span class="red">technical appendix</span>);

* Results from national inventory studies that measured the level of underreporting of detected TB cases, used for `r n.is` countries with about `r share.is`% of the global number of incident TB cases in `r yr`;

* TB notifications upward adjusted according to an incidence:notification ratio derived from a UHC SCI-based statistical model, used for `r n.uhc.indir` countries with `r share.uhc.indir`% of the global number of incident TB cases in `r yr`;

* TB notifications upward adjusted according to country-specific values for the UHC SCI, used for `r n.uhc.dir` countries with `r share.uhc.dir`% of the global number of incident TB cases in `r yr`;

* A country-specific customized approach, which was used for six African countries for which the UHC SCI methods did not work well. These countries accounted for `r share.spe.992`.0% of the global number of incident TB cases in `r yr`;

* TB notifications combined with TB mortality data from a national vital registration system. This was used for Brazil, which had `r share.spe.991`.0% of the global number of incident TB cases in `r yr`;

* TB notifications with no adjustment, used for `r n.spe.99.small` countries that reported less than 10 cases of TB in 2024 and three countries for which country-specific evidence suggested that no adjustment was appropriate (e.g. due to high levels of population-based screening as well as potential for overdiagnosis), which collectively accounted for `r share.spe.993+share.spe.994`% of the global number of incident cases in `r yr`;

* TB notifications and a standard upward adjustment to account for underreporting, overdiagnosis and underdiagnosis, retained based on bilateral discussions with national TB programmes for four countries for which this method had previously been used for several years, which accounted for about `r share.spe.995`% of the global number of incident TB cases in `r yr`


For `r n.model.inc` countries with the biggest absolute reductions in TB notifications during the COVID-19 pandemic that were a clear departure from historic trends, estimates of TB incidence in 2020–`r yr` were based on country or region-specific dynamic models. These methods are described in detail in a <span class="red">technical appendix</span>. For all other countries, the same methods as those used for the period 2010–2019 continued to be applied.


The <span style="color:#f4a81d">orange</span> dots on the map show the `r length(cm.lst)`  countries for which a country-specific dynamic model has been used and the  <span style="color:#754d06">brown</span> dots show the `r length(rm.lst)` countries for which a region-specific dynamic model has been used.  These two groups of countries accounted for `r share.cm`% and `r share.rm`% of the estimated total global number of incident cases in `r yr`, respectively.

<hr />
<br />

### `r anch("Fig. 1.1.13")`<span class="red">Fig. 1.1.13</span> Main methods used to estimate TB incidence, 2010&#8211;`r yr` 
<div class="subhead">The <span style="color:#f4a81d">orange</span> dots on the map show the countries for which a country-specific dynamic model has been used and the  <span style="color:#754d06">brown</span> dots show the countries for which a region-specific dynamic model has been used.</div> 


```{r echo=FALSE, message=FALSE, warning=FALSE, results = "asis", dev = 'png', fig_1.1.13, fig.alt="Main methods used to estimate TB incidence, 2010–2024"} 


method1=est.meth.inc[,.(iso3,var)]

f1.1.13_plot1 <- whomapper(
  X = method1, water_col = 'white',
  legend_title = 'Main method',
  #colours = brewer.pal(4, "Paired"),
  colours = brewer.pal(8, "Set3"),
  #colours= c("#2c7fb8","#bdd7e7","#88be3b","#c51b8a","#fbb4b9"),
  legend_pos = c(0.12,0.48)
  )


f1.1.13_plot  <- f1.1.13_plot1 +
  add_marker(iso3=cm.lst, col="#f4a81d", size=2, shape=16) + 
  add_marker(iso3=rm.lst, col="#754d06", size=2, shape=16) + 
  guides(shape=FALSE) 
  # add_annotate("text", label="Country-specific dynamic model", x=-129.5, y=-56, size=I(2), include_coord = TRUE) +
  # add_annotate("text", label="Region-specific dynamic model", x=-137, y=-61, size=I(2)) +
  # add_annotate("point",  x=198.5, y=-56, color="#f4a81d", size=I(2)) +
  # add_annotate("point", x=191, y=-61, color="#754d06", size=I(2))

output_ggplot(f1.1.13_plot, dta, show_static=TRUE, pdf_csv_folder, save_csv, save_pdf)

```

</div>


Country-specific details are available in the [Global tuberculosis report app](https://www.who.int/teams/global-tuberculosis-programme/data#app) and [country profiles](https://worldhealthorg.shinyapps.io/tb_profiles/).


Note: All of the percentage reductions or increases referred to in the text of this webpage were calculated based on unrounded numbers, as opposed to the rounded numbers that appear in the interactive graphics.



`r anch("refs")`

<hr style="border:1px solid gray20">

**References**

1. Floyd K, Glaziou P, Houben R, Sumner T, White RG, Raviglione M. Global tuberculosis targets and milestones set for 2016-2035: definition and rationale. Int J Tuberc Lung Dis. 2018;22(7):723-30 (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6005124/). 

2. World Health Organization. Resolution WHA67.1. Global strategy and targets for tuberculosis prevention, care and control after 2015. Geneva: World Health Organization; 2014 (http://apps.who.int/gb/ebwha/pdf_files/WHA67/A67_R1-en.pdf). 

3. Guidelines for Accurate and Transparent Health Estimates Reporting (GATHER) [website] (http://gather-statement.org/). 
    
  
<hr style="border:1px solid gray20">

**General disclaimers**
<br>
The designations employed and the presentation of the material in this publication do not imply the expression of any opinion whatsoever on the part of WHO concerning the legal status of any country, territory, city or area or of its authorities, or concerning the delimitation of its frontiers or boundaries. Dotted and dashed lines on maps represent approximate border lines for which there may not yet be full agreement.


```{r js_functions}
# Insert javascript file containing common Kendo number formatting functions ----
cat(writeLines(readLines(here("report/resources/gtbr_js.htm"))))
```



```{r, json_2_1} 
# renaming variable for Kendo UI
names(global) <- gsub('[.]', '_', names(global))

names(regional) <- gsub('[.]', '_', names(regional))

names(hest) <- gsub('[.]', '_', names(hest))

names(income) <- gsub('[.]', '_', names(income))


dta <- est[iso3 %in% c('KHM','RUS','ZWE')]
names(dta) <- gsub('[.]', '_', names(dta))

desired_age_order <- c("0-4", "5-14", "15-24", "25-34", "35-44", "45-54", "55-64", "65plus")
globsplt$age <- factor(globsplt$age, levels = desired_age_order, ordered = TRUE)
regsplt$age <- factor(regsplt$age, levels = desired_age_order, ordered = TRUE)

```

<script type="text/javascript">

/* JSON data objects for the figures */



var fig_1_1_1a_data = `r subset(global,year>=2010) %>% dplyr::select(year,inc_num,inc_lo_num,inc_hi_num,c_newinc,inc_h_num,inc_h_hi_num,inc_h_lo_num) %>% toJSON("rows")`; 
var fig_1_1_1b_data = `r subset(global,year>=2010) %>% dplyr::select(year,inc,inc_lo,inc_hi,newinc,inc_h,inc_h_hi,inc_h_lo,inc_milestone) %>% toJSON("rows")`; 

var fig_1_1_5_data = `r globsplt %>% pivot_wider(names_from = sex, values_from = inc:pop) %>% mutate(inc_F = inc_F*(-1), newrel_F = newrel_F*(-1)) %>% mutate(diff_M = inc_M-newrel_M, diff_F=inc_F-newrel_F) %>% arrange(desc(age))%>% mutate(age=ifelse(age=="65plus","\u226565",as.character(age))) %>% toJSON("rows")`; 


var fig_1_1_5a_data = `r globsplt3.piv %>% arrange(age_group)%>% mutate(age_group=ifelse(age_group=="65plus","\u226565",as.character(age_group))) %>% toJSON("rows")`;


var fig_1_1_6_data = `r regsplt %>%  pivot_wider(names_from = sex, values_from = inc:newrel) %>% mutate(inc_F = inc_F*(-1), newrel_F = newrel_F*(-1)) %>% mutate(diff_M = inc_M-newrel_M, diff_F=inc_F-newrel_F) %>% arrange(desc(age)) %>% mutate(age=ifelse(age=="65plus","\u226565",as.character(age))) %>% toJSON("rows")`; 


var fig_1_1_6new_data_afr = `r disag_afr %>% arrange(age_group)%>% mutate(age_group=ifelse(age_group=="65plus","\u226565",as.character(age_group))) %>% toJSON("rows")`; 

var fig_1_1_6new_data_amr = `r disag_amr %>% arrange(age_group)%>% mutate(age_group=ifelse(age_group=="65plus","\u226565",as.character(age_group))) %>% toJSON("rows")`; 

var fig_1_1_6new_data_emr = `r disag_emr %>% arrange(age_group)%>% mutate(age_group=ifelse(age_group=="65plus","\u226565",as.character(age_group))) %>% toJSON("rows")`; 

var fig_1_1_6new_data_eur = `r disag_eur %>% arrange(age_group)%>% mutate(age_group=ifelse(age_group=="65plus","\u226565",as.character(age_group))) %>% toJSON("rows")`; 

var fig_1_1_6new_data_sea = `r disag_sea %>% arrange(age_group)%>% mutate(age_group=ifelse(age_group=="65plus","\u226565",as.character(age_group))) %>% toJSON("rows")`; 

var fig_1_1_6new_data_wpr = `r disag_wpr %>% arrange(age_group)%>% mutate(age_group=ifelse(age_group=="65plus","\u226565",as.character(age_group))) %>% toJSON("rows")`; 



var fig_1_1_7_data = `r subset(regional,year>=2010) %>% dplyr::select(region,year,inc,inc_lo,inc_hi,newinc,inc_h,inc_h_hi,inc_h_lo,inc_milestone) %>% toJSON("rows")`; 

var fig_1_1_8_data = `r subset(income,year>=2010) %>% dplyr::select(group,year,inc,inc_lo,inc_hi,newinc,inc_h,inc_h_hi,inc_h_lo) %>% toJSON("rows")`; 

var fig_1_1_9_data = `r subset(hest,year>=2010) %>% dplyr::select(country,iso3,year,inc,inc_lo,inc_hi,newinc,inc_h,inc_h_hi,inc_h_lo,inc_milestone) %>% toJSON("rows")`; 

var fig_1_1_10_data = `r subset(dta,year>=2010) %>% dplyr::select(country,iso3,year,inc,inc_lo,inc_hi,newinc,inc_h,inc_h_hi,inc_h_lo,inc_milestone) %>% toJSON("rows")`; 


</script>


```{js, echo=FALSE}

function tb_format_thou_2(n) { 
  //return thousands formatted to to significant figures
  nt = n/1000; 
  return num_spacer(Number(nt.toPrecision(2))*1000)
}

/* Functions to create the figures */

function createFig_1_1_1a(fig_ID) {
 
		$(fig_ID).kendoChart({
			dataSource: fig_1_1_1a_data,
			chartArea: {
				height: 500
			},	
			legend: {
				position: "bottom"
			},
      series: [{
				type: "line",
        name: "All TB cases",
				field: "inc_num",
				color: "#91A93E",
				tooltip: {
					visible: true,
					template: "All TB cases (#= category #): #= tb_format_thou(value) # 000"
				}
			},{
				type: "rangeArea",
				fromField: "inc_lo_num",
				toField: "inc_hi_num",
				color: "#91A93E",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= tb_format_thou(value.from) # 000–#= tb_format_thou(value.to) # 000"
				}
			},{
				type: "line",
        name: "Notifications of new and recurrent cases",
				field: "c_newinc",
				color: "black",
				tooltip: {
					visible: true,
					format: "{0}",
					template: "Notifications of new and recurrent cases (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "line",
        name: "TB cases in people living with HIV",
				field: "inc_h_num",
				color: "#ED1D24",
				tooltip: {
					visible: true,
					template: "TB cases in people living with HIV (#= category #): #= tb_format_thou(value) # 000"
				}
			},{
				type: "rangeArea",
				fromField: "inc_h_lo_num",
				toField: "inc_h_hi_num",
				color: "#ED1D24",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= tb_format_thou(value.from) # 000–#= tb_format_thou(value.to) # 000"
				}
			},],      
			valueAxis: {

        labels: {
					template: "#= axis_spacer(value/1e6) #"
				},
				title: {
					text: "Millions per year",
					visible: true
				},
        min: 0,

				line: {
					visible: false
				}
			}
			,
			categoryAxis: {
				field: "year",
				labels: {
					rotation: "auto",
          step: 2
				},
				majorGridLines: {
					visible: false
				},
				title: {
					text: "Year",
					visible: true
				}
			}

		});
}



function createFig_1_1_1b(fig_ID) {
 
		$(fig_ID).kendoChart({
			dataSource: fig_1_1_1b_data,
			chartArea: {
				height: 500
			},	
			legend: {
				position: "bottom"
			},
      series: [{
				type: "line",
        name: "All TB cases",
				field: "inc",
				color: "#91A93E",
				tooltip: {
					visible: true,
					template: "All TB cases (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "rangeArea",
				fromField: "inc_lo",
				toField: "inc_hi",
				color: "#91A93E",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= num_spacer(value.from) #–#= num_spacer(value.to) #"
				}
			},{
				type: "line",
        name: "Notifications of new and recurrent cases",
				field: "newinc",
				color: "black",
				tooltip: {
					visible: true,
					format: "{0}",
					template: "Notifications of new and recurrent cases (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "line",
        name: "TB cases in people living with HIV",
				field: "inc_h",
				color: "#ED1D24",
				tooltip: {
					visible: true,
					template: "Incidence rate of TB in people living with HIV (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "rangeArea",
				fromField: "inc_h_lo",
				toField: "inc_h_hi",
				color: "#ED1D24",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= num_spacer(value.from) #–#= num_spacer(value.to) #"
				}
			},{
        type: "line",
        dashType: "dash",
        field: "inc_milestone",
        color: "grey",
        markers: {
             size: 0,
             opacity: 0
           },
			tooltip: {
				visible: false,
			}
      },],      
      
			valueAxis: {
        labels: {
					template: "#= axis_spacer(value) #"
				},
				title: {
					text: "Rate per 100 000 population per year",
					visible: true
				},
        min: 0,
        max: 250,
				line: {
					visible: false
				}
			},      
      render: function (e) {
            var draw = kendo.drawing;
            var padding = 100;
            var padding2 = 300;
            var element = this.element;
            var rect = new kendo.geometry.Rect([padding, padding2], [element.width() - 2 * padding, element.height() - 2 * padding2]);

            var text = new draw.Text("2025 milestone", [0, 0], { font: "bold 9px Verdana,Arial,sans-serif" });
            draw.align([text], rect, "start");
            draw.vAlign([text], rect, "start");
            e.sender.surface.draw(text);
          },
			categoryAxis: {
				field: "year",
				labels: {
					rotation: "auto",
          step: 2
				},
				majorGridLines: {
					visible: false
				},
				title: {
					text: "Year",
					visible: true
				}
			}

		});
}


function createFig_1_1_5(fig_ID, data, min) {
  
		$(fig_ID).kendoChart({		
      dataSource: fig_1_1_5_data,			
      chartArea: {
				height: 500
			},	  
			legend: {
				position: "bottom"
			},
			seriesDefaults: {
				type: "bar",
        stack: true,
        gap: 0.2
			},
			series: [{
				field: "newrel_M",
				color: "#F4A81D",
        tooltip: {
				visible: true,
				template: "Number of cases notified in males aged #= category # years: #= num_spacer(value)#"
			}
			},{
				field: "diff_M",
				color: "#EEEEEE",
        tooltip: {
				visible: true,
				template: "Estimated TB incidence number in males aged #= category # years: #= tb_format_thou_2(dataItem.inc_M)#"
			}
			},{
				field: "newrel_F",
				color: "#6363C0",
        tooltip: {
				visible: true,
				template: "Number of cases notified in females aged #= category # years: #= num_spacer(value*(-1))#"
			}
			},{
				field: "diff_F",
				color: "#EEEEEE",
        tooltip: {
				visible: true,
				template: "Estimated TB incidence number in females aged #= category # years: #= tb_format_thou_2(dataItem.inc_F*(-1))#"
			}
			},
              ],
			valueAxis: {
				labels: {
				template:  "#= kendo.toString(Math.abs(value),'n0').replace(/,/g, ' ') #",
				},
        title: {
					text: "Number of cases"
				},
				line: {
					visible: false
				},
        axisCrossingValue: min,
        min: min
			},
			categoryAxis: {
				field: "age",
				labels: {
					rotation: "auto"
				},
        title: {
					text: "Age group (years)"
				},
				majorGridLines: {
					visible: false
				}			}
		});
}

function createFig_1_1_6(fig_ID, data, filter, min) {
  
  	// Filter the dataset on the country variable
		dataJSON = data.filter( element => element.name == filter);
  
		$(fig_ID).kendoChart({		
      dataSource: dataJSON,			
      chartArea: {
				height: 250
			},		     
      title: {
				text: filter,
				color: "black",
				font: "bold 14px  Arial,Helvetica,sans-serif",
        align: "center"
			},	  
			legend: {
				position: "bottom"
			},
			seriesDefaults: {
				type: "bar",
        stack: true,
        gap: 0.2
			},
			series: [{
				field: "newrel_M",
				color: "#F4A81D",
        tooltip: {
				visible: true,
				template: "Number of cases notified in males aged #= category # years: #= num_spacer(value)#"
			}
			},{
				field: "diff_M",
				color: "#EEEEEE",
        tooltip: {
				visible: true,
				template: "Estimated TB incidence number in males aged #= category # years: #= tb_format_thou_2(dataItem.inc_M)#"
			}
			},{
				field: "newrel_F",
				color: "#6363C0",
        tooltip: {
				visible: true,
				template: "Number of cases notified in females aged #= category # years: #= num_spacer(value*(-1))#"
			}
			},{
				field: "diff_F",
				color: "#EEEEEE",
        tooltip: {
				visible: true,
				template: "Estimated TB incidence number in females aged #= category # years: #= tb_format_thou_2(dataItem.inc_F*(-1))#"
			}
			},
              ],
			valueAxis: {
				labels: {
				template:  "#= kendo.toString(Math.abs(value),'n0').replace(/,/g, ' ') #",
				step:2
				},
        title: {
					text: "Number of cases"
				},
				line: {
					visible: false
				},
        axisCrossingValue: min,
        min: min
			},
			categoryAxis: {
				field: "age",
				labels: {
					rotation: "auto"
				},
        title: {
					text: "Age group (years)"
				},
				majorGridLines: {
					visible: false
				}			}
		});
}  


function createFig_1_1_7(fig_ID, data, filter, min, unit) {
 
  	// Filter the dataset on the country variable
		dataJSON = data.filter( element => element.region == filter);
  
		$(fig_ID).kendoChart({		
      dataSource: dataJSON,			
			chartArea: {
				height: 400
			},	      
      title: {
				text: filter,
				color: "black",
				font: "bold 14px  Arial,Helvetica,sans-serif",
        align: "center"
			},	  

			legend: {
				position: "bottom"
			},
      series: [{
				type: "line",
        name: "All TB cases",
				field: "inc",
				color: "#91A93E",
        markers: { size: 4},
				tooltip: {
					visible: true,
					template: "TB incidence rate (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "rangeArea",
				fromField: "inc_lo",
				toField: "inc_hi",
				color: "#91A93E",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= num_spacer(value.from) #–#= num_spacer(value.to) #"
				}
			},{
				type: "line",
        name: "Notifications of new and recurrent cases",
				field: "newinc",
				color: "black",     
        markers: { size: 4},
				tooltip: {
					visible: true,
					format: "{0}",
					template: "TB case notification rate (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "line",
        name: "TB cases in people living with HIV",
				field: "inc_h",
				color: "#ED1D24", 
        markers: { size: 4},
				tooltip: {
					visible: true,
					template: "Incidence rate of TB in people living with HIV (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "rangeArea",
				fromField: "inc_h_lo",
				toField: "inc_h_hi",
				color: "#ED1D24",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= num_spacer(value.from) #–#= num_spacer(value.to) #"
				}
			},{
        type: "line",
        dashType: "dash",
        field: "inc_milestone",
        color: "grey",
        markers: {
             size: 0,
             opacity: 0
           },
			tooltip: {
				visible: false
			}
      },],      
      
			valueAxis: {
        labels: {
					template: "#= axis_spacer(value) #"
				},
				title: {
					text: "Rate per 100 000 population\nper year",
					visible: true
				},
        min: 0,
        axisCrossingValue: 0.1,
				line: {
					visible: false
				}
			},      

			categoryAxis: {
				field: "year",
				labels: {
					rotation: "auto",
          step: 2
				},
				majorGridLines: {
					visible: false
				},

				title: {
					text: "Year",
					visible: true
				}
			}

		});
}





function createFig_1_1_9_10(fig_ID, data, filter, min, max, unit) {
 
  	// Filter the dataset on the country variable
		dataJSON = data.filter( element => element.country == filter);
  
		$(fig_ID).kendoChart({		
      dataSource: dataJSON,			
			chartArea: {
				height: 250
			},	      
      title: {
				text: filter,
				color: "black",
				font: "bold 14px  Arial,Helvetica,sans-serif",
        align: "center"
			},	  

			legend: {
				position: "bottom"
			},
      series: [{
				type: "line",
				field: "inc",
				color: "#91A93E",
        markers: { size: 4},
				tooltip: {
					visible: true,
					template: "TB incidence rate (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "rangeArea",
				fromField: "inc_lo",
				toField: "inc_hi",
				color: "#91A93E",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= num_spacer(value.from) #–#= num_spacer(value.to) #"
				}
			},{
				type: "line",
				field: "newinc",
				color: "black",     
        markers: { size: 4},
				tooltip: {
					visible: true,
					format: "{0}",
					template: "TB case notification rate (#= category #): #= num_spacer(value) #"
				}
			},{
        type: "line",
        dashType: "dash",
        field: "inc_milestone",
        color: "grey",
        markers: {
             size: 0,
             opacity: 0
           },
			tooltip: {
				visible: false
			}
      },],      
      
			valueAxis: {
        labels: {
					template: "#= axis_spacer(value) #"
				},
				title: {
					text: "Rate per 100 000 population\nper year",
					visible: true
				},
       min: 0,
        axisCrossingValue: 0.1,
				line: {
					visible: false
				}
			},      

			categoryAxis: {
				field: "year",
				labels: {
					rotation: "auto",
          step: 2
				},
				majorGridLines: {
					visible: false
				},

				title: {
					text: "Year",
					visible: true
				}
			}

		});
}



function createFig_1_1_8(fig_ID, data, filter, min, unit) {
 
  	// Filter the dataset on the country variable
		dataJSON = data.filter( element => element.group == filter);
  
		$(fig_ID).kendoChart({		
      dataSource: dataJSON,			
			chartArea: {
				height: 400
			},	      
      title: {
				text: filter,
				color: "black",
				font: "bold 14px  Arial,Helvetica,sans-serif",
        align: "center"
			},	  

			legend: {
				position: "bottom"
			},
      series: [{
				type: "line",
        name: "All TB cases",
				field: "inc",
				color: "#91A93E",
        markers: { size: 4},
				tooltip: {
					visible: true,
					template: "TB incidence rate (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "rangeArea",
				fromField: "inc_lo",
				toField: "inc_hi",
				color: "#91A93E",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= num_spacer(value.from) #–#= num_spacer(value.to) #"
				}
			},{
				type: "line",
        name: "Notifications of new and recurrent cases",
				field: "newinc",
				color: "black",     
        markers: { size: 4},
				tooltip: {
					visible: true,
					format: "{0}",
					template: "TB case notification rate (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "line",
        name: "TB cases in people living with HIV",
				field: "inc_h",
				color: "#ED1D24", 
        markers: { size: 4},
				tooltip: {
					visible: true,
					template: "Incidence rate of TB in people living with HIV (#= category #): #= num_spacer(value) #"
				}
			},{
				type: "rangeArea",
				fromField: "inc_h_lo",
				toField: "inc_h_hi",
				color: "#ED1D24",
				tooltip: {
					visible: true,
				format: "{0}",
				template: "95% uncertainty interval (#= category #): #= num_spacer(value.from) #–#= num_spacer(value.to) #"
				}
			},{
        type: "line",
        dashType: "dash",
        field: "inc_milestone",
        color: "grey",
        markers: {
             size: 0,
             opacity: 0
           },
			tooltip: {
				visible: false
			}
      },],      
      
			valueAxis: {
        labels: {
					template: "#= axis_spacer(value) #"
				},
				title: {
					text: "Rate per 100 000 population\nper year",
					visible: true
				},
        min: 0,
        axisCrossingValue: 0.1,
				line: {
					visible: false
				}
			},      

			categoryAxis: {
				field: "year",
				labels: {
					rotation: "auto",
          step: 2
				},
				majorGridLines: {
					visible: false
				},

				title: {
					text: "Year",
					visible: true
				}
			}

		});
}


function createFig_1_1_5a(fig_ID, data) {
   
		$(fig_ID).kendoChart({
			dataSource: data,
			chartArea: {
				height: 400
			},	
			legend: {
				position: "bottom"
			},
			
			series: [{
        type: "line",
				field: "best_F",
        errorLowField: "lo_F",
        errorHighField: "hi_F",
        errorBars: {color: "#6363C0", line: { width: 3 }},
        opacity: 0,
				color: "#6363C0",
        markers: {
          visible: true,
          background: "#6363C0",
          size: 8
        },
        
			tooltip: {
				visible: true,
				template: "Estimated number of TB cases in females aged #= category # years: #= tb_format_thou_2(value) #"
			}
			},{
				type: "rangeArea",
				fromField: "lo_F",
				toField: "hi_F",
				opacity: 0,
        color: "#6363C0",
				tooltip: {
				visible: true,
				format: "{0}",
				template: "95% uncertainty interval (age group #= category #): #= tb_format_thou_2(value.from) #\u2013#= tb_format_thou_2(value.to) #"
				}
			},
              
			{
			  type : "bar",
			  gap: 0.2,
				field: "newrel_F",
				color: "#6363C0",
				opacity: 0.6,
        tooltip: {
				visible: true,
				template: "Number of cases notified in females aged #= category # years: #= num_spacer(value) #"
			}
			}],
			

              
			valueAxis: {
				labels: {
				template:  "#= kendo.toString(Math.abs(value),'n0').replace(/,/g, ' ') #",
				},
				title: {
					text: "Number of cases"
				},
				line: {
					visible: false
				},
        min: 0,
        max: 1400000,
			},
			categoryAxis: {
				field: "age_group",
				labels: {
					rotation: "auto"
				},
				title: {
					text: "Age group (years)"
				},
				majorGridLines: {
					visible: true
				}
			}

		});
}


function createFig_1_1_5b(fig_ID, data) {
   
		$(fig_ID).kendoChart({
			dataSource: data,
			chartArea: {
				height: 400
			},	
			legend: {
				position: "bottom"
			},
			
			series: [{
        type: "line",
				field: "best_M",
        errorLowField: "lo_M",
        errorHighField: "hi_M",
        errorBars: {color: "#F4A81D", line: { width: 3 }},
        opacity: 0,
				color: "#F4A81D",
        markers: {
          visible: true,
          background: "#F4A81D",
          size: 8
        },
        
			tooltip: {
				visible: true,
				template: "Estimated number of TB cases in males aged #= category # years: #= tb_format_thou_2(value) #"
			}
			},{
				type: "rangeArea",
				fromField: "lo_M",
				toField: "hi_M",
				opacity: 0,
        color: "#F4A81D",
				tooltip: {
				visible: true,
				format: "{0}",
				template: "95% uncertainty interval (age group #= category #): #= tb_format_thou_2(value.from) #\u2013#= tb_format_thou_2(value.to) #"
				}
			},
              
			{
			  type : "bar",
			  gap: 0.2,
				field: "newrel_M",
				color: "#F4A81D",
				opacity: 0.6,
        tooltip: {
				visible: true,
				template: "Number of cases notified in males aged #= category # years: #= num_spacer(value) #"
			}
			}],
			

              
			valueAxis: {
				labels: {
				template:  "#= kendo.toString(Math.abs(value),'n0').replace(/,/g, ' ') #",
				},
				title: {
					text: "Number of cases"
				},
				line: {
					visible: false
				},
        min: 0,
        max: 1400000,
			},
			categoryAxis: {
				field: "age_group",
				labels: {
					rotation: "auto"
				},
				title: {
					text: "Age group (years)"
				},
				majorGridLines: {
					visible: true
				}
			}

		});
}





function createFig_1_1_6a(fig_ID, data,maxy,title) {
   
		$(fig_ID).kendoChart({
			dataSource: data,
			chartArea: {
				height: 300
			},	
			legend: {
				position: "bottom"
			},
			title: {
				text: title,
				color: "black",
				font: "bold 14px  Arial,Helvetica,sans-serif",
        align: "center"
			},	  

			
			series: [{
        type: "line",
				field: "best_F",
        errorLowField: "lo_F",
        errorHighField: "hi_F",
        errorBars: {color: "#6363C0", line: { width: 3 }},
        opacity: 0,
				color: "#6363C0",
        markers: {
          visible: true,
          background: "#6363C0",
          size: 8
        },
        
			tooltip: {
				visible: true,
				template: "Estimated number of TB cases in females aged #= category # years: #= tb_format_thou_2(value) #"
			}
			},{
				type: "rangeArea",
				fromField: "lo_F",
				toField: "hi_F",
				opacity: 0,
        color: "#6363C0",
				tooltip: {
				visible: true,
				format: "{0}",
				template: "95% uncertainty interval (age group #= category #): #= tb_format_thou_2(value.from) #\u2013#= tb_format_thou_2(value.to) #"
				}
			},
              
			{
			  type : "bar",
			  gap: 0.2,
				field: "newrel_F",
				color: "#6363C0",
				opacity: 0.6,
        tooltip: {
				visible: true,
				template: "Number of cases notified in females aged #= category # years: #= num_spacer(value) #"
			}
			}],
			

              
			valueAxis: {
				labels: {
				template:  "#= kendo.toString(Math.abs(value),'n0').replace(/,/g, ' ') #",
				},
				title: {
					text: "Number of cases"
				},
				line: {
					visible: false
				},
        min: 0,
        max: maxy,
			},
			categoryAxis: {
				field: "age_group",
				labels: {
					rotation: "auto"
				},
				title: {
					text: "Age group (years)"
				},
				majorGridLines: {
					visible: true
				}
			}

		});
}


function createFig_1_1_6b(fig_ID, data,maxy,title) {
   
		$(fig_ID).kendoChart({
			dataSource: data,
			chartArea: {
				height: 300
			},	
			legend: {
				position: "bottom"
			},
			title: {
				text: title,
				color: "black",
				font: "bold 14px  Arial,Helvetica,sans-serif",
        align: "center"
			},	 			
			series: [{
        type: "line",
				field: "best_M",
        errorLowField: "lo_M",
        errorHighField: "hi_M",
        errorBars: {color: "#F4A81D", line: { width: 3 }},
        opacity: 0,
				color: "#F4A81D",
        markers: {
          visible: true,
          background: "#F4A81D",
          size: 8
        },
        
			tooltip: {
				visible: true,
				template: "Estimated number of TB cases in males aged #= category # years: #= tb_format_thou_2(value) #"
			}
			},{
				type: "rangeArea",
				fromField: "lo_M",
				toField: "hi_M",
				opacity: 0,
        color: "#F4A81D",
				tooltip: {
				visible: true,
				format: "{0}",
				template: "95% uncertainty interval (age group #= category #): #= tb_format_thou_2(value.from) #\u2013#= tb_format_thou_2(value.to) #"
				}
			},
              
			{
			  type : "bar",
			  gap: 0.2,
				field: "newrel_M",
				color: "#F4A81D",
				opacity: 0.6,
        tooltip: {
				visible: true,
				template: "Number of cases notified in males aged #= category # years: #= num_spacer(value) #"
			}
			}],
			

              
			valueAxis: {
				labels: {
				template:  "#= kendo.toString(Math.abs(value),'n0').replace(/,/g, ' ') #",
				},
				title: {
					text: "Number of cases"
				},
				line: {
					visible: false
				},
        min: 0,
        max: maxy,
			},
			categoryAxis: {
				field: "age_group",
				labels: {
					rotation: "auto"
				},
				title: {
					text: "Age group (years)"
				},
				majorGridLines: {
					visible: true
				}
			}

		});
}




```

```{js, echo=FALSE}

/* Create the figures after the document has been loaded */

  $(document).ready(function () {
  
  createFig_1_1_1a("#fig_1_1_1a");
  createFig_1_1_1b("#fig_1_1_1b");
  
  createFig_1_1_5("#fig_1_1_5_global",fig_1_1_5_data,-1e6);
  
  createFig_1_1_5a("#fig_1_1_5a",fig_1_1_5a_data);
  createFig_1_1_5b("#fig_1_1_5b",fig_1_1_5a_data);

  createFig_1_1_6("#fig_1_1_6_EUR",fig_1_1_6_data,"European Region",-20000);
  createFig_1_1_6("#fig_1_1_6_AFR",fig_1_1_6_data,"African Region",-250000);
  createFig_1_1_6("#fig_1_1_6_EMR",fig_1_1_6_data,"Eastern Mediterranean Region",-80000);
  createFig_1_1_6("#fig_1_1_6_AMR",fig_1_1_6_data,"Region of the Americas",-30000);
  createFig_1_1_6("#fig_1_1_6_WPR",fig_1_1_6_data,"Western Pacific Region",-200000);
  createFig_1_1_6("#fig_1_1_6_SEAR",fig_1_1_6_data,"South-East Asia Region",-350000);
  
  
  createFig_1_1_6a("#fig_1_1_6a_AFR",fig_1_1_6new_data_afr,500000,"African Region")
  createFig_1_1_6b("#fig_1_1_6b_AFR",fig_1_1_6new_data_afr,500000,"African Region")
  
  createFig_1_1_6a("#fig_1_1_6a_AMR",fig_1_1_6new_data_amr,80000,"Region of the Americas")
  createFig_1_1_6b("#fig_1_1_6b_AMR",fig_1_1_6new_data_amr,80000,"Region of the Americas")

  createFig_1_1_6a("#fig_1_1_6a_EMR",fig_1_1_6new_data_emr,200000,"Eastern Mediterranean Region")
  createFig_1_1_6b("#fig_1_1_6b_EMR",fig_1_1_6new_data_emr,200000,"Eastern Mediterranean Region")

  createFig_1_1_6a("#fig_1_1_6a_EUR",fig_1_1_6new_data_eur,60000,"European Region")
  createFig_1_1_6b("#fig_1_1_6b_EUR",fig_1_1_6new_data_eur,60000,"European Region")

  createFig_1_1_6a("#fig_1_1_6a_SEA",fig_1_1_6new_data_sea,600000,"South-East Asia Region")
  createFig_1_1_6b("#fig_1_1_6b_SEA",fig_1_1_6new_data_sea,600000,"South-East Asia Region")

  createFig_1_1_6a("#fig_1_1_6a_WPR",fig_1_1_6new_data_wpr,700000,"Western Pacific Region")
  createFig_1_1_6b("#fig_1_1_6b_WPR",fig_1_1_6new_data_wpr,700000,"Western Pacific Region")

  
  createFig_1_1_7("#fig_1_1_7_EUR",fig_1_1_7_data,"European Region",1,10);
  createFig_1_1_7("#fig_1_1_7_AFR",fig_1_1_7_data,"African Region",1,10);
  createFig_1_1_7("#fig_1_1_7_EMR",fig_1_1_7_data,"Eastern Mediterranean Region",0.1,10);
  createFig_1_1_7("#fig_1_1_7_AMR",fig_1_1_7_data,"Region of the Americas",1,4);
  createFig_1_1_7("#fig_1_1_7_WPR",fig_1_1_7_data,"Western Pacific Region",1,10);
  createFig_1_1_7("#fig_1_1_7_SEAR",fig_1_1_7_data,"South-East Asia Region",1,10);
 
  createFig_1_1_8("#fig_1_1_8_HIC",fig_1_1_8_data,"High-income countries",1,10);
  createFig_1_1_8("#fig_1_1_8_LIC",fig_1_1_8_data,"Low-income countries",1,10);
  createFig_1_1_8("#fig_1_1_8_LMC",fig_1_1_8_data,"Lower-middle-income countries",0.1,10);
  createFig_1_1_8("#fig_1_1_8_UMC",fig_1_1_8_data,"Upper-middle-income countries",1,4);
  
  createFig_1_1_9_10("#fig_1_1_9_AGO",fig_1_1_9_data,"Angola",80, 600, 2);
  createFig_1_1_9_10("#fig_1_1_9_COG",fig_1_1_9_data,"Congo",100,1000,2);
  createFig_1_1_9_10("#fig_1_1_9_IND",fig_1_1_9_data,"India",80,1000,2);
  createFig_1_1_9_10("#fig_1_1_9_MNG",fig_1_1_9_data,"Mongolia",70,1000,2);
  createFig_1_1_9_10("#fig_1_1_9_PAK",fig_1_1_9_data,"Pakistan",5,600,4);
  createFig_1_1_9_10("#fig_1_1_9_THA",fig_1_1_9_data,"Thailand",50,600,2);
  
  createFig_1_1_9_10("#fig_1_1_9_BGD",fig_1_1_9_data,"Bangladesh",50,600,2);
  createFig_1_1_9_10("#fig_1_1_9_PRK",fig_1_1_9_data,"Democratic People's\nRepublic of Korea",100,700,2);
  createFig_1_1_9_10("#fig_1_1_9_IDN",fig_1_1_9_data,"Indonesia",20,600,2);
  createFig_1_1_9_10("#fig_1_1_9_MOZ",fig_1_1_9_data,"Mozambique",100,600,2);
  createFig_1_1_9_10("#fig_1_1_9_PNG",fig_1_1_9_data,"Papua New Guinea",100,700,2);
  createFig_1_1_9_10("#fig_1_1_9_UGA",fig_1_1_9_data,"Uganda",100,600,2);
  
  createFig_1_1_9_10("#fig_1_1_9_BRA",fig_1_1_9_data,"Brazil",20,100,2);
  createFig_1_1_9_10("#fig_1_1_9_COD",fig_1_1_9_data,"Democratic Republic\nof the Congo",100,600,2);
  createFig_1_1_9_10("#fig_1_1_9_KEN",fig_1_1_9_data,"Kenya",100,1500,2);
  createFig_1_1_9_10("#fig_1_1_9_MMR",fig_1_1_9_data,"Myanmar",50,1500,2);
  createFig_1_1_9_10("#fig_1_1_9_PHL",fig_1_1_9_data,"Philippines",100,1000,2);
  createFig_1_1_9_10("#fig_1_1_9_TZA",fig_1_1_9_data,"United Republic of Tanzania",50,1500,2);
  
  createFig_1_1_9_10("#fig_1_1_9_CAF",fig_1_1_9_data,"Central African Republic",50,1000,2);
  createFig_1_1_9_10("#fig_1_1_9_ETH",fig_1_1_9_data,"Ethiopia",50,1500,2);
  createFig_1_1_9_10("#fig_1_1_9_LSO",fig_1_1_9_data,"Lesotho",100,2500,2);
  createFig_1_1_9_10("#fig_1_1_9_NAM",fig_1_1_9_data,"Namibia",200,3000,2);
  createFig_1_1_9_10("#fig_1_1_9_SLE",fig_1_1_9_data,"Sierra Leone",50,600,2);
  createFig_1_1_9_10("#fig_1_1_9_VNM",fig_1_1_9_data,"Viet Nam",50,800,2);
  
  createFig_1_1_9_10("#fig_1_1_9_CHN",fig_1_1_9_data,"China",20,200,2);
  createFig_1_1_9_10("#fig_1_1_9_GAB",fig_1_1_9_data,"Gabon",100,1000,2);
  createFig_1_1_9_10("#fig_1_1_9_LBR",fig_1_1_9_data,"Liberia",50,600,2);
  createFig_1_1_9_10("#fig_1_1_9_NGA",fig_1_1_9_data,"Nigeria",20,400,2);
  createFig_1_1_9_10("#fig_1_1_9_ZAF",fig_1_1_9_data,"South Africa",200,3000,2);
  createFig_1_1_9_10("#fig_1_1_9_ZMB",fig_1_1_9_data,"Zambia",100,1500,2);
  
  createFig_1_1_9_10("#fig_1_1_10_KHM",fig_1_1_10_data,"Cambodia",100,1500,2);
  createFig_1_1_9_10("#fig_1_1_10_RUS",fig_1_1_10_data,"Russian Federation",20,200,2);
  createFig_1_1_9_10("#fig_1_1_10_ZWE",fig_1_1_10_data,"Zimbabwe",100,1500,2);

});  

```



